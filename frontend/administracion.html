<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>EPMAPS - Estadísticas</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Free Website Template" name="keywords">
    <meta content="Free Website Template" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;400&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"> 

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/style.min.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 70%;
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 40px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        canvas {
            margin-top: 20px;
        }
        .text-blue {
            color: rgb(9, 9, 80) !important;
        }

         /* Estilo específico para el contenedor del gráfico de pastel */
         #chart-container {
            width: 50%; /* Ajusta el ancho del contenedor del gráfico de pastel según sea necesario */
            margin: 0 auto; /* Centra el contenedor horizontalmente */
        }

        #myChart3 {
            max-width: 500px; /* Ajusta el tamaño máximo del gráfico de pastel */
            max-height: 400px; /* Ajusta el tamaño máximo del gráfico de pastel */
            width: 100%; /* Hace que el gráfico de pastel se ajuste al ancho del contenedor */
            height: auto; /* Hace que la altura del gráfico de pastel se ajuste automáticamente */
        }
       
        
        </style>

        
</head>

<body>
    <!-- Navbar Start -->
    <div class="container-fluid p-0 nav-bar">
        <nav class="navbar navbar-expand-lg bg-none navbar-dark py-3">
            <a href="index.html" class="navbar-brand px-lg-4 m-0">
                <h1 class="m-0 display-4 text-uppercase text-white">EPMAPS</h1>
            </a>
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
                <div class="navbar-nav ml-auto p-4">
                    <a href="index.html" class="nav-item nav-link">Inicio</a>

                    <a href="service.html" class="nav-item nav-link">Servicios</a>
                    
                    
                    <a href="contact.html" class="nav-item nav-link">Contacto</a>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle active" data-toggle="dropdown">Administración</a>
                        <div class="dropdown-menu text-capitalize">
                            <a href="usuarios.html" class="dropdown-item">Usuarios</a>
                            <a href="servicios.html" class="dropdown-item">Servicios</a>
                            <a href="pagos.html" class="dropdown-item">Pagos</a>
                            <a href="notificaciones.html" class="dropdown-item">Notificaciones</a>
                            <a href="administracion.html" class="dropdown-item">Estadísticas</a>
                        </div>
                    </div>
                     <!-- Search Form Start -->
                <form id="searchForm" class="form-inline ml-4">
                    <input class="form-control mr-sm-2 rounded-pill search-input" type="search" placeholder="Buscar" aria-label="Buscar" id="searchInput">
                    <button class="btn btn-outline-light my-2 my-sm-0 rounded-pill" type="submit">Buscar</button>
                </form>
                <!-- Search Form End -->
                    <a href="cart2.html" class="nav-link">
                        <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                        <span class="counter" id="nro-productos"> 0</span>
                    </a>
                
                    
                </div>
            </div>
        </nav>
    </div>
    <!-- Navbar End -->


    <!-- Page Header Start -->
    <div class="container-fluid page-header mb-5 position-relative overlay-bottom">
        <div class="d-flex flex-column align-items-center justify-content-center pt-0 pt-lg-5" style="min-height: 400px">
            <h1 class="display-4 mb-3 mt-0 mt-lg-5 text-white text-uppercase">Gráficos Estadísticos</h1>
            <div class="d-inline-flex mb-lg-5">
                <p class="m-0 text-white"><a class="text-white" href="">Análisis</a></p>
                <p class="m-0 text-white px-2">/</p>
                <p class="m-0 text-white">Toma de Decisiones</p>
            </div>
        </div>
    </div>
    <!-- Page Header End -->


    <div class="container">
        <div class="section">
            <h1>Resumen Financiero Mensual - 2023</h1>
            <table id="financeTable2023">
                <thead>
                    <tr>
                        <th>Año</th>
                        <th>Mes</th>
                        <th>Total Ingresos</th>
                    </tr>            
                </thead>
                <tbody>
                </tbody>
            </table>
            <canvas id="chart2023"></canvas>
        </div>
        <div class="section">
            <h1>Resumen Financiero Mensual - 2024</h1>
            <table id="financeTable2024">
                <thead>
                    <tr>
                        <th>Año</th>
                        <th>Mes</th>
                        <th>Total Ingresos</th>
                    </tr>            
                </thead>
                <tbody>
                </tbody>
            </table>
            <canvas id="chart2024"></canvas>
        </div>
    </div>
    <script>
        $(document).ready(function(){
            var apiURL = "http://localhost:8083/api/pagos/ObtenerPagosMensuales";
            $.ajax({
                url: apiURL,
                type: 'GET',
                success: function(data){
                    var chartData = {
                        2023: [],
                        2024: []
                    };

                    data.forEach(item => {
                        if (item.Year === 2023) {
                            chartData[2023].push(item);
                        } else if (item.Year === 2024) {
                            chartData[2024].push(item);
                        }
                    });

                    var months = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

                    Object.keys(chartData).forEach(year => {
                        var ctx = $('#chart' + year);
                        new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: months,
                                datasets: [
                                    {
                                        label: 'Total Ingresos ' + year,
                                        data: Array.from({ length: 12 }).fill(0).map((_, index) => chartData[year].find(dataItem => dataItem.Month === index + 1)?.TotalEarnings || 0),
                                        borderColor: year === '2023' ? 'rgb(17,192,192)' : 'rgb(128,0,128)', // Cambiar el color a morado para el año 2024
        backgroundColor: year === '2023' ? 'rgba(75,192,192,0.5)' : 'rgba(128,0,128,0.5)', // Cambiar el color de fondo a morado para el año 2024
                                        fill: false
                                    }
                                ]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });

                        var tableBody = $('#financeTable' + year + ' tbody');
                        chartData[year].forEach(function(item) {
                            tableBody.append('<tr><td>' + item.Year + '</td><td>' + months[item.Month - 1] + '</td><td>' + item.TotalEarnings.toLocaleString() + '</td></tr>');
                        });
                    });
                },
                error: function(xhr, status, error) {
                    alert('Error al cargar los datos: ' + error);
                }
            });
        });
    </script>


<div class="container">
    <h1 class="mt-5">Usuarios Actuales Activos</h1>
    <div id="chart-container">
        <canvas id="myChart3"></canvas>
    </div>
</div>
    <!-- Aquí va el script del gráfico -->
    <script>
        $(document).ready(function(){
            $.ajax({
                url: 'http://localhost:8083/api/usuario/ContarPorEstado',
                method: 'GET',
                success: function(response) {
                    // Crear el gráfico de pastel
                    var ctx = document.getElementById('myChart3').getContext('2d');
                    var myChart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: ['Usuarios Activos', 'Usuarios Inactivos'],
                            datasets: [{
                                label: 'Cantidad',
                                data: [response.UsuariosActivos, response.UsuariosInactivos],
                                backgroundColor: [
                                    'rgba(255, 159, 64, 0.2)', // Color naranja para usuarios activos
                                    'rgba(255, 99, 132, 0.2)', // Color rojo para usuarios inactivos
                                ],
                                borderColor: [
                                    'rgba(255, 159, 64, 1)',
                                    'rgba(255, 99, 132, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(tooltipItem) {
                                            return tooltipItem.label + ': ' + tooltipItem.raw;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            });
        });
    </script>


<div class="container">
    <h1 class="mt-5">Cantidad de Pagos por Servicio</h1>
    <div id="chart-container2">
        <canvas id="barChart"></canvas>
    </div>
</div>

<script>
    $(document).ready(function () {
        $.ajax({
            url: 'http://localhost:8083/api/pagos/ContarPagosPorServicio/',
            method: 'GET',
            success: function (data) {
                var labels = [];
                var dataValues = [];

                // Itera sobre los resultados de la API y agrega los datos al arreglo de etiquetas y valores
                data.forEach(function (item) {
                    labels.push(item.Descripcion);
                    dataValues.push(item.CantidadPagos);
                });

                // Configuración del gráfico de barras
                var ctx = document.getElementById('barChart').getContext('2d');
                var barChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Cantidad de Pagos por Servicio',
                            data: dataValues,
                            backgroundColor: 'rgba(54, 162, 235, 0.5)', // Color de las barras
                            borderColor: 'rgba(54, 162, 235, 1)', // Color del borde de las barras
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true // Empieza el eje Y desde cero
                            }
                        }
                    }
                });
            },
            error: function (xhr, status, error) {
                console.error('Error al cargar los datos: ' + error);
            }
        });
    });
</script>


<script>
        $(document).ready(function () {
            // Gráfico de barras de Pagos por Servicio
            $.ajax({
                url: 'http://localhost:8083/api/pagos/ContarPagosPorServicio/',
                method: 'GET',
                success: function (data) {
                    var labels = [];
                    var dataValues = [];

                    data.forEach(function (item) {
                        labels.push(item.Descripcion);
                        dataValues.push(item.CantidadPagos);
                    });

                    var ctx = document.getElementById('barChart').getContext('2d');
                    var barChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Cantidad de Pagos por Servicio',
                                data: dataValues,
                                backgroundColor: 'rgba(54, 162, 235, 0.5)', // Color de las barras
                                borderColor: 'rgba(54, 162, 235, 1)', // Color del borde de las barras
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                },
                error: function (xhr, status, error) {
                    console.error('Error al cargar los datos: ' + error);
                }
            });

            // Gráfico de barras de Notificaciones por Estado
            $.ajax({
                url: 'http://localhost:8083/api/notificaciones/ContarPorEstado/',
                method: 'GET',
                success: function (data) {
                    var labels = [];
                    var dataValues = [];

                    data.forEach(function (item) {
                        labels.push(item.Estado);
                        dataValues.push(item.Cantidad);
                    });

                    var ctx = document.getElementById('barChartNotificaciones').getContext('2d');
                    var barChartNotificaciones = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Cantidad de Notificaciones por Estado',
                                data: dataValues,
                                backgroundColor: 'rgba(75, 192, 75, 0.5)', // Color de las barras (verde)
                                borderColor: 'rgba(75, 192, 75, 1)', // Color del borde de las barras (verde)
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                },
                error: function (xhr, status, error) {
                    console.error('Error al cargar los datos: ' + error);
                }
            });
        });
    </script>

<div class="container">
    <h1 class="mt-5">Cantidad de Notificaciones por Estado</h1>
    <div id="chart-container-notificaciones">
        <canvas id="barChartNotificaciones"></canvas>
    </div>
</div>

<script>
    $(document).ready(function () {
        // Gráfico de barras de Notificaciones por Estado
        $.ajax({
            url: 'http://localhost:8083/api/notificaciones/ContarPorEstado/',
            method: 'GET',
            success: function (data) {
                var labels = [];
                var dataValues = [];

                data.forEach(function (item) {
                    labels.push(item.Estado);
                    dataValues.push(item.Cantidad);
                });

                var ctx = document.getElementById('barChartNotificaciones').getContext('2d');
                var barChartNotificaciones = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Cantidad de Notificaciones por Estado',
                            data: dataValues,
                            backgroundColor: 'rgba(75, 192, 75, 0.5)', // Color de las barras (verde)
                            borderColor: 'rgba(75, 192, 75, 1)', // Color del borde de las barras (verde)
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            },
            error: function (xhr, status, error) {
                console.error('Error al cargar los datos: ' + error);
            }
        });
    });
</script>
    <!-- Footer Start -->
<div class="container-fluid footer text-white mt-5 pt-5 px-0 position-relative overlay-top">
    <div class="row mx-0 pt-5 px-sm-3 px-lg-5 mt-4">
        <div class="col-lg-3 col-md-6 mb-5">
            <h4 class="text-white text-uppercase mb-4" style="letter-spacing: 3px;">Contáctanos</h4>
            <p><i class="fa fa-map-marker-alt mr-2"></i>Mariana de Jesús, Quito, Ecuador</p>
            <p><i class="fa fa-phone-alt mr-2"></i>1800-242424</p>
            <p class="m-0"><i class="fa fa-envelope mr-2"></i>atencion.cliente@aguaquito.gob.ec</p>
        </div>
        <div class="col-lg-3 col-md-6 mb-5">
            <h4 class="text-white text-uppercase mb-4" style="letter-spacing: 3px;">Síguenos</h4>
            <p>En todas nuestras redes sociales oficiales</p>
            <div class="d-flex justify-content-start">
                <a class="btn btn-lg btn-outline-light btn-lg-square mr-2" href="https://x.com/aguadequito"><i class="fab fa-twitter"></i></a>
                <a class="btn btn-lg btn-outline-light btn-lg-square mr-2" href="https://www.facebook.com/AguadeQuito"><i class="fab fa-facebook-f"></i></a>
                <a class="btn btn-lg btn-outline-light btn-lg-square mr-2" href="https://www.linkedin.com/company/epmaps-agua-de-quito/"><i class="fab fa-linkedin-in"></i></a>
                <a class="btn btn-lg btn-outline-light btn-lg-square" href="https://www.instagram.com/aguaquito/?hl=es"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-5">
            <h4 class="text-white text-uppercase mb-4" style="letter-spacing: 3px;">Horarios</h4>
            <div>
                <h6 class="text-white text-uppercase">Lunes - Viernes</h6>
                <p>8.00 AM - 5.00 PM</p>
                <h6 class="text-white text-uppercase">Sábado</h6>
                <p>8.00 PM - 12.00 PM</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-5">
            <h4 class="text-white text-uppercase mb-4" style="letter-spacing: 3px;">Comunidad</h4>
            <p>Mantente informado de todas las novedades</p>
            <div class="w-100">
                <div class="input-group">
                    <input type="text" class="form-control border-light" style="padding: 25px;" placeholder="Correo">
                    <div class="input-group-append">
                        <button class="btn btn-primary font-weight-bold px-3">Unirse</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid text-center text-white border-top mt-4 py-4 px-sm-3 px-md-5" style="border-color: rgba(256, 256, 256, .1) !important;">
        <p class="mb-2 text-white">2024 &copy; <a class="font-weight-bold" href="#"></a>EPMAPS</a></p>
        
    </div>
</div>
<!-- Footer End -->


    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>


    <!-- JavaScript Libraries -->
    <!-- <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script> -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Contact Javascript File -->
    <script src="mail/jqBootstrapValidation.min.js"></script>
    <script src="mail/contact.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>
    <script src="js/broadcastHandler.js"></script>
    <script src="js/cartService.js"></script>
    <script src="js/busqueda.js"></script>
    <script src="js/search.js"></script>
    
    <script>
        $(document).ready(function() {
            $('#searchForm').submit(function(event) {
                event.preventDefault();
                var searchInput = $('#searchInput').val().trim();
                if (searchInput) {
                    window.location.href = 'busqueda.html?query=' + encodeURIComponent(searchInput);
                }
            });
        });
    </script>

    
</body>

</html>